MODULE ANALYSIS
  USE PARAMETERS
  
CONTAINS
  
  SUBROUTINE BOOTSTRAP(ARRAY, SKEWNESS_BOOTSTRAP_ARRAY, j)
!-------------------------------------------------------------------------------
    ! Take an array of valid data for the bootsrtap method and using a random number generator (rand() currently in this case) generate, randomly, the indices of that array and fill it with those random data elements.
    ! To generate a random number in the range {n,...,m} use j = n + FLOOR((m + 1 - n)*u) where u is a rangom number generated by the subroutine RANDOM_NUMBER(u).
!-------------------------------------------------------------------------------
    USE PARAMETERS
    
    REAL(KIND=dp), DIMENSION(:), ALLOCATABLE :: ARRAY
    REAL(KIND=dp), DIMENSION(:), ALLOCATABLE :: SKEWNESS_BOOTSTRAP_ARRAY
    INTEGER :: j
    
    REAL(KIND=dp), DIMENSION(:), ALLOCATABLE :: BOOTSTRAP_ARRAY
    
    ! Get size of the data array
    INTEGER :: i, ARRAY_SIZE, BOOTSTRAP_ARRAY_SIZE, RANDOM_INTEGER, N
    REAL(KIND=dp) :: RANDOM_VALUE, SKEWNESS_VALUE
    REAL(KIND=dp) :: SUMMATION, MEAN, TOTAL_SUMMATION, r
    REAL(KIND=dp) :: CENTRAL_MOMENT_NUMERATOR, CENTRAL_MOMENT_DENOMINATOR
    ARRAY_SIZE = SIZE(ARRAY)
    BOOTSTRAP_ARRAY_SIZE = BOOTSTRAP_MULTIPLIER*SIZE(ARRAY)
    
    
    ALLOCATE(BOOTSTRAP_ARRAY(BOOTSTRAP_ARRAY_SIZE))

    PRINT*, BOOTSTRAP_ARRAY_SIZE
    
    DO i = 1, BOOTSTRAP_ARRAY_SIZE
       CALL RANDOM_NUMBER(RANDOM_VALUE) ! Range [0,1)
       PRINT*, "RANDOM NUMBER =", RANDOM_VALUE
       RANDOM_INTEGER = (1 + FLOOR((ARRAY_SIZE)*RANDOM_VALUE))
       PRINT*, RANDOM_INTEGER
       BOOTSTRAP_ARRAY(i) = ARRAY(RANDOM_INTEGER)
    END DO

    N = 0
    DO i = 1, BOOTSTRAP_ARRAY_SIZE
       PRINT*, BOOTSTRAP_ARRAY(i)
       N = N +1
    END DO

    PRINT*, "N = ", N

    !__________________________________________________________________________________________________________________________________________________________

    SUM = 0.0_dp

    DO i = 1, BOOTSTRAP_ARRAY_SIZE
       SUMMATION = SUMMATION + BOOTSTRAP_ARRAY(i)
    END DO

    MEAN = SUMMATION/BOOTSTRAP_ARRAY_SIZE

    TOTAL_SUMMATION = 0.0_dp
    r = 3.0_dp
    DO i = 1, BOOTSTRAP_ARRAY_SIZE
       TOTAL_SUMMATION = TOTAL_SUMMATION + (BOOTSTRAP_ARRAY(i) - MEAN)**r
    END DO

    CENTRAL_MOMENT_NUMERATOR = TOTAL_SUMMATION/BOOTSTRAP_ARRAY_SIZE

    TOTAL_SUMMATION = 0.0_dp
    r = 2.0_dp
    DO i = 1, BOOTSTRAP_ARRAY_SIZE
       TOTAL_SUMMATION = TOTAL_SUMMATION + (BOOTSTRAP_ARRAY(i) - MEAN)**r
    END DO
    
    CENTRAL_MOMENT_DENOMINATOR = TOTAL_SUMMATION/BOOTSTRAP_ARRAY_SIZE

    SKEWNESS_VALUE = (CENTRAL_MOMENT_NUMERATOR/(CENTRAL_MOMENT_DENOMINATOR)**(3.0/2.0))
    
    PRINT*, "SKEWNESS =", SKEWNESS_VALUE

    SKEWNESS_BOOTSTRAP_ARRAY(j) = SKEWNESS_VALUE
    
  END SUBROUTINE BOOTSTRAP
END MODULE ANALYSIS

  

   !CONTAINS

    !REAL(KIND=dp) FUNCTION CENTRAL_MOMENT CM_VALUE(ARRAY, r)
    !REAL(KIND=dp), DIMENSION(:), ALLOCATABLE :: ARRAY
    !REAL(KIND=dp) :: r
    
    !INTEGER :: i, NUMBER_OF_ARRAY_ELEMENTS
    !REAL(KIND=dp) :: SUM, MEAN, SUMMATION
    
    !NUMBER_OF_ARRRAY_ELEMENTS = SIZE(ARRAY)

    !SUM = 0.0_dp

    !DO i = 1, NUMBER_OF_ARRAY_ELEMENTS
     !  SUM = SUM + ARRAY(i)
    !END DO

    !MEAN = SUM/NUMBER_OF_ARRAY_ELEMENTS

    !SUMMATION = 0.0_dp
    !DO i = 1, NUMBER_OF_ARRAY_ELEMENTS
     !  SUMMATION = SUMMATION + (ARRAY(i) - MEAN)
    !END DO

    !CM_VALUE = SUMMATION/NUMBER_OF_ARRAY_ELEMENTS
    !RETURN
 ! END FUNCTION CENTRAL_MOMENT

  !CONTAINS

   ! REAL(KIND=dp) FUNCTION SKEWNESS S_VALUE(ARRAY)
    !REAL(KIND=dp), DIMENSION(:), ALLOCATABLE :: ARRAY

    !REAL(KIND=dp) :: CENTRAL_MOMENT_NUMERATOR, CENTRAL_MOMENT_DENOMINATOR

    !CENTRAL_MOMENT_NUMERATOR = CENTRAL_MOMENT(ARRAY, 3)
    !CENTRAL_MOMENT_DENOMINATOR = CENTRAL_MOMENT(ARRAY, 2)

    !S_VALUE = (CENTRAL_MOMENT_NUMERATOR/(CENTRAL_MOMENT_DENOMINATOR)**(3.0/2.0))
    !RETURN
  !END FUNCTION SKEWNESS
